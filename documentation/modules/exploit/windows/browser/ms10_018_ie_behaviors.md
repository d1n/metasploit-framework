## MS10-018 Microsoft Internet Explorer DHTML Behaviors Use After Free

This module exploits a use-after-free vulnerability within 
the DHTML behaviors functionality of Microsoft Internet 
Explorer versions 6 and 7. This bug was discovered being 
used in-the-wild and was previously known as the "iepeers" 
vulnerability. The name comes from Microsoft's suggested 
workaround to block access to the iepeers.dll file. 
According to Nico Waisman, "The bug itself is when trying to 
persist an object using the setAttribute, which end up 
calling VariantChangeTypeEx with both the source and the 
destination being the same variant. So if you send as a 
variant an IDISPATCH the algorithm will try to do a 
VariantClear of the destination before using it. This will 
end up on a call to PlainRelease which deref the reference 
and clean the object." NOTE: Internet Explorer 8 and 
Internet Explorer 5 are not affected.


## Module Name
exploit/windows/browser/ms10_018_ie_behaviors

## Authors
* unknown
* Trancer <mtrancer[at]gmail.com>
* Nanika
* jduck


## References
* http://cvedetails.com/cve/2010-0806/
* http://www.osvdb.org/62810
* http://www.securityfocus.com/bid/38615
* http://www.microsoft.com/technet/security/advisory/981374.mspx
* http://www.avertlabs.com/research/blog/index.php/2010/03/09/targeted-internet-explorer-0day-attack-announced-cve-2010-0806/
* http://eticanicomana.blogspot.com/2010/03/aleatory-persitent-threat.html
* http://technet.microsoft.com/en-us/security/bulletin/MS10-018



## Targets
* (Automatic) IE6, IE7 on Windows NT, 2000, XP, 2003 and Vista
* IE 6 SP0-SP2 (onclick)
* IE 7.0 (marquee)


## Platforms
win

## Reliability
[Good](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/browser/ms10_018_ie_behaviors
msf exploit(ms10_018_ie_behaviors) > show targets
   ... a list of targets ...
msf exploit(ms10_018_ie_behaviors) > set TARGET <target-id>
msf exploit(ms10_018_ie_behaviors) > show options
   ... show and set options ...
msf exploit(ms10_018_ie_behaviors) > run
```
    
    