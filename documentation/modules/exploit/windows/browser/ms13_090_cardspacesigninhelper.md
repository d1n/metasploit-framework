## MS13-090 CardSpaceClaimCollection ActiveX Integer Underflow

This module exploits a vulnerability on the 
CardSpaceClaimCollection class from the icardie.dll ActiveX 
control. The vulnerability exists while the handling of the 
CardSpaceClaimCollection object. CardSpaceClaimCollections 
stores a collection of elements on a SafeArray and keeps a 
size field, counting the number of elements on the 
collection. By calling the remove() method on an empty 
CardSpaceClaimCollection it is possible to underflow the 
length field, storing a negative integer. Later, a call to 
the add() method will use the corrupted length field to 
compute the address where write into the SafeArray data, 
allowing to corrupt memory with a pointer to controlled 
contents. This module achieves code execution by using 
VBScript as discovered in the wild on November 2013 to (1) 
create an array of html OBJECT elements, (2) create holes, 
(3) create a CardSpaceClaimCollection whose SafeArray data 
will reuse one of the holes, (4) corrupt one of the legit 
OBJECT elements with the described integer overflow and (5) 
achieve code execution by forcing the use of the corrupted 
OBJECT.


## Module Name
exploit/windows/browser/ms13_090_cardspacesigninhelper

## Authors
* Unknown
* juan vazquez


## References
* http://cvedetails.com/cve/2013-3918/
* http://www.osvdb.org/99555
* http://www.securityfocus.com/bid/63631
* http://technet.microsoft.com/en-us/security/bulletin/MS13-090
* http://blogs.technet.com/b/msrc/archive/2013/11/11/activex-control-issue-being-addressed-in-update-tuesday.aspx



## Targets
* Windows XP with IE 8


## Platforms
win

## Reliability
[Normal](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/browser/ms13_090_cardspacesigninhelper
msf exploit(ms13_090_cardspacesigninhelper) > show targets
   ... a list of targets ...
msf exploit(ms13_090_cardspacesigninhelper) > set TARGET <target-id>
msf exploit(ms13_090_cardspacesigninhelper) > show options
   ... show and set options ...
msf exploit(ms13_090_cardspacesigninhelper) > run
```
    
    