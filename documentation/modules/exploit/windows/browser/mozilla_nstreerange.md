## Mozilla Firefox "nsTreeRange" Dangling Pointer Vulnerability

This module exploits a code execution vulnerability in 
Mozilla Firefox 3.6.x <= 3.6.16 and 3.5.x <= 3.5.17 found in 
nsTreeSelection. By overwriting a subfunction of 
invalidateSelection it is possible to free the nsTreeRange 
object that the function currently operates on. Any further 
operations on the freed object can result in remote code 
execution. Utilizing the call setup the function provides 
it's possible to bypass DEP without the need for a ROP. 
Sadly this exploit is still either dependent on Java or 
bound by ASLR because Firefox doesn't employ any ASLR-free 
modules anymore.


## Module Name
exploit/windows/browser/mozilla_nstreerange

## Authors
* regenrecht
* xero


## References
* http://cvedetails.com/cve/2011-0073/
* http://www.osvdb.org/72087
* http://www.securityfocus.com/bid/47663
* http://www.zerodayinitiative.com/advisories/ZDI-11-157
* https://bugzilla.mozilla.org/show_bug.cgi?id=630919
* http://www.mozilla.org/security/announce/2011/mfsa2011-13.html



## Targets
* Auto (Direct attack against Windows XP, otherwise through Java, if enabled)
* Firefox Runtime, fails with ASLR
* Java Runtime (7.10.3052.4), best against ASLR
* Java JVM (20.1.0.02)
* Java Regutils (6.0.260.3)


## Platforms
* win

## Reliability
[Normal](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/browser/mozilla_nstreerange
msf exploit(mozilla_nstreerange) > show targets
   ... a list of targets ...
msf exploit(mozilla_nstreerange) > set TARGET <target-id>
msf exploit(mozilla_nstreerange) > show options
   ... show and set options ...
msf exploit(mozilla_nstreerange) > run
```
    
    