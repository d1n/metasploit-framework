## MS13-055 Microsoft Internet Explorer CAnchorElement Use-After-Free

In IE8 standards mode, it's possible to cause a 
use-after-free condition by first creating an illogical 
table tree, where a CPhraseElement comes after CTableRow, 
with the final node being a sub table element. When the 
CPhraseElement's outer content is reset by using either 
outerText or outerHTML through an event handler, this 
triggers a free of its child element (in this case, a 
CAnchorElement, but some other objects apply too), but a 
reference is still kept in function 
SRunPointer::SpanQualifier. This function will then pass on 
the invalid reference to the next functions, eventually used 
in mshtml!CElement::Doc when it's trying to make a call to 
the object's SecurityContext virtual function at offset 
+0x70, which results a crash. An attacker can take advantage 
of this by first creating an CAnchorElement object, let it 
free, and then replace the freed memory with another fake 
object. Successfully doing so may allow arbitrary code 
execution under the context of the user. This bug is 
specific to Internet Explorer 8 only. It was originally 
discovered by Jose Antonio Vazquez Gonzalez and reported to 
iDefense, but was discovered again by Orange Tsai at Hitcon 
2013.


## Module Name
exploit/windows/browser/ms13_055_canchor

## Authors
* Jose Antonio Vazquez Gonzalez
* Orange Tsai
* Peter Vreugdenhil
* sinn3r


## References
* http://cvedetails.com/cve/2013-3163/
* http://www.osvdb.org/94981
* http://technet.microsoft.com/en-us/security/bulletin/MS13-055
* https://speakerd.s3.amazonaws.com/presentations/0df98910d26c0130e8927e81ab71b214/for-share.pdf



## Targets
* Automatic
* IE 8 on Windows XP SP3
* IE 8 on Windows 7


## Platforms
win

## Reliability
[Normal](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/browser/ms13_055_canchor
msf exploit(ms13_055_canchor) > show targets
   ... a list of targets ...
msf exploit(ms13_055_canchor) > set TARGET <target-id>
msf exploit(ms13_055_canchor) > show options
   ... show and set options ...
msf exploit(ms13_055_canchor) > run
```
    
    