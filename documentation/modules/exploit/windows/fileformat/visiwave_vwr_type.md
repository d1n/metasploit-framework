## VisiWave VWR File Parsing Vulnerability

This module exploits a vulnerability found in VisiWave's 
Site Survey Report application. When processing .VWR files, 
VisiWaveReport.exe attempts to match a valid pointer based 
on the 'Type' property (valid ones include 'Properties', 
'TitlePage', 'Details', 'Graph', 'Table', 'Text', 'Image'), 
but if a match isn't found, the function that's supposed to 
handle this routine ends up returning the input as a 
pointer, and later used in a CALL DWORD PTR [EDX+10] 
instruction. This allows attackers to overwrite it with any 
arbitrary value, and results code execution. A patch is 
available at visiwave.com; the fix is done by XORing the 
return value as null if no match is found, and then it is 
validated before use. NOTE: During installation, the 
application will register two file handle's, VWS and VWR and 
allows a victim user to 'double click' the malicious VWR 
file and execute code. This module was also built to bypass 
ASLR and DEP.


## Module Name
exploit/windows/fileformat/visiwave_vwr_type

## Authors
* mr_me <steventhomasseeley[at]gmail.com>
* TecR0c <roccogiovannicalvi[at]gmail.com>


## References
* http://cvedetails.com/cve/2011-2386/
* http://www.osvdb.org/72464
* http://www.visiwave.com/blog/index.php?/archives/4-Version-2.1.9-Released.html
* http://www.stratsec.net/Research/Advisories/VisiWave-Site-Survey-Report-Trusted-Pointer-%28SS-20



## Targets
* Windows XP SP3/Windows 7 SP0


## Platforms
win

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/fileformat/visiwave_vwr_type
msf exploit(visiwave_vwr_type) > show targets
   ... a list of targets ...
msf exploit(visiwave_vwr_type) > set TARGET <target-id>
msf exploit(visiwave_vwr_type) > show options
   ... show and set options ...
msf exploit(visiwave_vwr_type) > run
```
    
    