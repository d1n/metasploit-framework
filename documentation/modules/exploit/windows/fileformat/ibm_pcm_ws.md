## IBM Personal Communications iSeries Access WorkStation 5.9 Profile

The IBM Personal Communications I-Series application 
WorkStation is susceptible to a stack-based buffer overflow 
vulnerability within file parsing in which data copied to a 
location in memory exceeds the size of the reserved 
destination area. The buffer is located on the runtime 
program stack. When the WorkStation file is opened it will 
reach the code path at 0x67575180 located in pcspref.dll 
which conducts string manipulation and validation on the 
data supplied in the WorkStation file. The application will 
first check if 'Profile' header exists and appends a dot 
with the next parameter within the file. It will then 
measure the character length of the header by calling 
strcspn with a dot as its null-terminated character. It will 
then write the header into memory and ensure the header ends 
with a NUL character. The parameter character array is 
passed to the strcpy() function. The application has 
declared a 52-element character array for the destination 
for strcpy function. The function does not perform bounds 
checking therefore, data can be written paste the end of the 
buffer variable resulting in corruption of adjacent 
variables including other local variables, program state 
information and function arguments. You will notice that the 
saved RETURN address at offset 0x6c is overwritten by the 
data written past the buffer. To ensure we can perform 
arbitrary code execution we must we provide a valid pointer 
at 0x74 which is used as a argument for the called function 
at 0x675751ED as a id file extension parameter. Once the 
caller regains control we will reach our RETURN. The Ret 
instruction will be used to pop the overwritten saved return 
address which was currupted. This exploit has been written 
to bypass 2 mitigations DEP and ASLR on a Windows platform. 
Versions tested: IBM System i Access for Windows V6R1M0 
version 06.01.0001.0000a Which bundles pcsws.exe version 
5090.27271.709 Tested on: Microsoft Windows XP [Version 
5.1.2600] Microsoft Windows Vista [Version 6.0.6002] 
Microsoft Windows 7 [Version 6.1.7600]


## Module Name
exploit/windows/fileformat/ibm_pcm_ws

## Authors
TecR0c <roccogiovannicalvi[at]gmail.com>


## References
* http://cvedetails.com/cve/2012-0201/
* http://www.osvdb.org/79657
* https://www-304.ibm.com/support/docview.wss?uid=swg21586166



## Targets
* IBM WorkStation 5.9 (Windows XP SP3)
* IBM WorkStation 5.9 (Windows 7, Windows Vista)


## Platforms
win

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/fileformat/ibm_pcm_ws
msf exploit(ibm_pcm_ws) > show targets
   ... a list of targets ...
msf exploit(ibm_pcm_ws) > set TARGET <target-id>
msf exploit(ibm_pcm_ws) > show options
   ... show and set options ...
msf exploit(ibm_pcm_ws) > run
```
    
    