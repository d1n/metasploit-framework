## Windows ANI LoadAniIcon() Chunk Size Stack Buffer Overflow (SMTP)

This module exploits a buffer overflow vulnerability in the 
LoadAniIcon() function of USER32.dll. The flaw is triggered 
through Outlook Express by using the CURSOR style sheet 
directive to load a malicious .ANI file. This vulnerability 
was discovered by Alexander Sotirov of Determina and was 
rediscovered, in the wild, by McAfee.


## Module Name
exploit/windows/email/ms07_017_ani_loadimage_chunksize

## Authors
* hdm
* skape


## References
* http://technet.microsoft.com/en-us/security/bulletin/MS07-017
* http://cvedetails.com/cve/2007-0038/
* http://cvedetails.com/cve/2007-1765/
* http://www.osvdb.org/33629
* http://www.securityfocus.com/bid/23194
* http://www.microsoft.com/technet/security/advisory/935423.mspx



## Targets
* Automatic
* Windows XP SP2 user32.dll 5.1.2600.2622
* Windows XP SP2 userenv.dll English
* Windows XP SP2 userenv.dll French
* Windows XP SP0/SP1 netui2.dll English
* Windows 2000 SP0-SP4 netui2.dll English
* Windows Vista user32.dll 6.0.6000.16386
* Windows XP SP2 user32.dll (5.1.2600.2180) Multi Language
* Windows XP SP2 user32.dll (5.1.2600.2180) English
* Windows XP SP2 userenv.dll Portuguese (Brazil)
* Windows XP SP1a userenv.dll English
* Windows XP SP1a shell32.dll English


## Platforms
win

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/email/ms07_017_ani_loadimage_chunksize
msf exploit(ms07_017_ani_loadimage_chunksize) > show targets
   ... a list of targets ...
msf exploit(ms07_017_ani_loadimage_chunksize) > set TARGET <target-id>
msf exploit(ms07_017_ani_loadimage_chunksize) > show options
   ... show and set options ...
msf exploit(ms07_017_ani_loadimage_chunksize) > run
```
    
    