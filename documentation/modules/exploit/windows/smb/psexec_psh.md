## Microsoft Windows Authenticated Powershell Command Execution

This module uses a valid administrator username and password 
to execute a powershell payload using a similar technique to 
the "psexec" utility provided by SysInternals. The payload 
is encoded in base64 and executed from the commandline using 
the -encodedcommand flag. Using this method, the payload is 
never written to disk, and given that each payload is 
unique, is less prone to signature based detection. A 
persist option is provided to execute the payload in a while 
loop in order to maintain a form of persistence. In the 
event of a sandbox observing PSH execution, a delay and 
other obfuscation may be added to avoid detection. In order 
to avoid interactive process notifications for the current 
user, the psh payload has been reduced in size and wrapped 
in a powershell invocation which hides the window entirely.


## Module Name
exploit/windows/smb/psexec_psh

## Authors
* Royce @R3dy__ Davis <rdavis[at]accuvant.com>
* RageLtMan <rageltman[at]sempervictus>


## References
* http://cvedetails.com/cve/1999-0504/
* http://www.osvdb.org/3106
* http://www.accuvant.com/blog/2012/11/13/owning-computers-without-shell-access
* http://sourceforge.net/projects/smbexec/
* http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx



## Targets
* Automatic


## Platforms
win

## Reliability
[Manual](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/smb/psexec_psh
msf exploit(psexec_psh) > show targets
   ... a list of targets ...
msf exploit(psexec_psh) > set TARGET <target-id>
msf exploit(psexec_psh) > show options
   ... show and set options ...
msf exploit(psexec_psh) > run
```
    
    