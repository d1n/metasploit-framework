## MS08-067 Microsoft Server Service Relative Path Stack Corruption

This module exploits a parsing flaw in the path 
canonicalization code of NetAPI32.dll through the Server 
Service. This module is capable of bypassing NX on some 
operating systems and service packs. The correct target must 
be used to prevent the Server Service (along with a dozen 
others in the same process) from crashing. Windows XP 
targets seem to handle multiple successful exploitation 
events, but 2003 targets will often crash or hang on 
subsequent attempts. This is just the first version of this 
module, full support for NX bypass on 2003, along with other 
platforms, is still in development.


## Module Name
exploit/windows/smb/ms08_067_netapi

## Authors
* hdm
* Brett Moore <brett.moore[at]insomniasec.com>
* frank2 <frank2[at]dc949.org>
* jduck


## References
* http://cvedetails.com/cve/2008-4250/
* http://www.osvdb.org/49243
* http://technet.microsoft.com/en-us/security/bulletin/MS08-067
* http://www.rapid7.com/vulndb/lookup/dcerpc-ms-netapi-netpathcanonicalize-dos



## Targets
* Automatic Targeting
* Windows 2000 Universal
* Windows XP SP0/SP1 Universal
* Windows 2003 SP0 Universal
* Windows XP SP2 English (AlwaysOn NX)
* Windows XP SP2 English (NX)
* Windows XP SP3 English (AlwaysOn NX)
* Windows XP SP3 English (NX)
* Windows XP SP2 Arabic (NX)
* Windows XP SP2 Chinese - Traditional / Taiwan (NX)
* Windows XP SP2 Chinese - Simplified (NX)
* Windows XP SP2 Chinese - Traditional (NX)
* Windows XP SP2 Czech (NX)
* Windows XP SP2 Danish (NX)
* Windows XP SP2 German (NX)
* Windows XP SP2 Greek (NX)
* Windows XP SP2 Spanish (NX)
* Windows XP SP2 Finnish (NX)
* Windows XP SP2 French (NX)
* Windows XP SP2 Hebrew (NX)
* Windows XP SP2 Hungarian (NX)
* Windows XP SP2 Italian (NX)
* Windows XP SP2 Japanese (NX)
* Windows XP SP2 Korean (NX)
* Windows XP SP2 Dutch (NX)
* Windows XP SP2 Norwegian (NX)
* Windows XP SP2 Polish (NX)
* Windows XP SP2 Portuguese - Brazilian (NX)
* Windows XP SP2 Portuguese (NX)
* Windows XP SP2 Russian (NX)
* Windows XP SP2 Swedish (NX)
* Windows XP SP2 Turkish (NX)
* Windows XP SP3 Arabic (NX)
* Windows XP SP3 Chinese - Traditional / Taiwan (NX)
* Windows XP SP3 Chinese - Simplified (NX)
* Windows XP SP3 Chinese - Traditional (NX)
* Windows XP SP3 Czech (NX)
* Windows XP SP3 Danish (NX)
* Windows XP SP3 German (NX)
* Windows XP SP3 Greek (NX)
* Windows XP SP3 Spanish (NX)
* Windows XP SP3 Finnish (NX)
* Windows XP SP3 French (NX)
* Windows XP SP3 Hebrew (NX)
* Windows XP SP3 Hungarian (NX)
* Windows XP SP3 Italian (NX)
* Windows XP SP3 Japanese (NX)
* Windows XP SP3 Korean (NX)
* Windows XP SP3 Dutch (NX)
* Windows XP SP3 Norwegian (NX)
* Windows XP SP3 Polish (NX)
* Windows XP SP3 Portuguese - Brazilian (NX)
* Windows XP SP3 Portuguese (NX)
* Windows XP SP3 Russian (NX)
* Windows XP SP3 Swedish (NX)
* Windows XP SP3 Turkish (NX)
* Windows 2003 SP1 English (NO NX)
* Windows 2003 SP1 English (NX)
* Windows 2003 SP1 Japanese (NO NX)
* Windows 2003 SP1 Spanish (NO NX)
* Windows 2003 SP1 Spanish (NX)
* Windows 2003 SP1 French (NO NX)
* Windows 2003 SP1 French (NX)
* Windows 2003 SP2 English (NO NX)
* Windows 2003 SP2 English (NX)
* Windows 2003 SP2 German (NO NX)
* Windows 2003 SP2 German (NX)
* Windows 2003 SP2 Portuguese - Brazilian (NX)
* Windows 2003 SP2 Spanish (NO NX)
* Windows 2003 SP2 Spanish (NX)
* Windows 2003 SP2 Japanese (NO NX)
* Windows 2003 SP2 French (NO NX)
* Windows 2003 SP2 French (NX)


## Platforms
win

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/smb/ms08_067_netapi
msf exploit(ms08_067_netapi) > show targets
   ... a list of targets ...
msf exploit(ms08_067_netapi) > set TARGET <target-id>
msf exploit(ms08_067_netapi) > show options
   ... show and set options ...
msf exploit(ms08_067_netapi) > run
```
    
    