## HP Data Protector Create New Folder Buffer Overflow

This module exploits a stack buffer overflow in HP Data 
Protector 5. The overflow occurs in the creation of new 
folders, where the name of the folder is handled in a 
insecure way by the dpwindtb.dll component. While the 
overflow occurs in the stack, the folder name is split in 
fragments in this insecure copy. Because of this, this 
module uses egg hunting to search a non corrupted copy of 
the payload in the heap. On the other hand the overflowed 
buffer is stored in a frame protected by stack cookies, 
because of this SEH handler overwrite is used. Any user of 
HP Data Protector Express is able to create new folders and 
trigger the vulnerability. Moreover, in the default 
installation the 'Admin' user has an empty password. 
Successful exploitation will lead to code execution with the 
privileges of the "dpwinsdr.exe" (HP Data Protector Express 
Domain Server Service) process, which runs as SYSTEM by 
default.


## Module Name
exploit/windows/misc/hp_dataprotector_new_folder

## Authors
* juan vazquez
* sinn3r


## References
* http://cvedetails.com/cve/2012-0124/
* http://www.osvdb.org/80105
* http://www.securityfocus.com/bid/52431
* https://community.rapid7.com/community/metasploit/blog/2012/07/06/an-example-of-egghunting-to-exploit-cve-2012-0124



## Targets
* HP Data Protector Express 6.0.00.11974 / Windows XP SP3
* HP Data Protector Express 5.0.00.59287 / Windows XP SP3


## Platforms
win

## Reliability
[Normal](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/misc/hp_dataprotector_new_folder
msf exploit(hp_dataprotector_new_folder) > show targets
   ... a list of targets ...
msf exploit(hp_dataprotector_new_folder) > set TARGET <target-id>
msf exploit(hp_dataprotector_new_folder) > show options
   ... show and set options ...
msf exploit(hp_dataprotector_new_folder) > run
```
    
    