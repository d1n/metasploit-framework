## Microsoft SQL Server Payload Execution via SQL Injection

This module will execute an arbitrary payload on a Microsoft 
SQL Server, using a SQL injection vulnerability. Once a 
vulnerability is identified this module will use xp_cmdshell 
to upload and execute Metasploit payloads. It is necessary 
to specify the exact point where the SQL injection 
vulnerability happens. For example, given the following 
injection: http://www.example.com/show.asp?id=1;exec 
xp_cmdshell 'dir';--&cat=electrical you would need to set 
the following path: set GET_PATH 
/showproduct.asp?id=1;[SQLi];--&cat=foobar In regard to the 
payload, unless there is a closed port in the web server, 
you dont want to use any "bind" payload, specially on port 
80, as you will stop reaching the vulnerable web server 
host. You want a "reverse" payload, probably to your port 80 
or to any other outbound port allowed on the firewall. For 
privileged ports execute Metasploit msfconsole as root. 
Currently, three delivery methods are supported. First, the 
original method uses Windows 'debug.com'. File size 
restrictions are avoidied by incorporating the debug bypass 
method presented by SecureStat at Defcon 17. Since this 
method invokes ntvdm, it is not available on x86_64 systems. 
A second method takes advantage of the Command Stager 
subsystem. This allows using various techniques, such as 
using a TFTP server, to send the executable. By default the 
Command Stager uses 'wcsript.exe' to generate the executable 
on the target. Finally, ReL1K's latest method utilizes 
PowerShell to transmit and recreate the payload on the 
target. NOTE: This module will leave a payload executable on 
the target system when the attack is finished.


## Module Name
exploit/windows/mssql/mssql_payload_sqli

## Authors
* David Kennedy "ReL1K" <kennedyd013[at]gmail.com>
* jduck
* Rodrigo Marcos


## References
* http://cvedetails.com/cve/2000-0402/
* http://www.osvdb.org/557
* http://www.securityfocus.com/bid/1281
* http://cvedetails.com/cve/2000-1209/
* http://www.osvdb.org/15757
* http://www.securityfocus.com/bid/4797
* http://www.secforce.co.uk/blog/2011/01/penetration-testing-sql-injection-and-metasploit/



## Targets
* Automatic


## Platforms
win

## Reliability
[Excellent](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/mssql/mssql_payload_sqli
msf exploit(mssql_payload_sqli) > show targets
   ... a list of targets ...
msf exploit(mssql_payload_sqli) > set TARGET <target-id>
msf exploit(mssql_payload_sqli) > show options
   ... show and set options ...
msf exploit(mssql_payload_sqli) > run
```
    
    