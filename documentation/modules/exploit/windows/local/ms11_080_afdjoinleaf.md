## MS11-080 AfdJoinLeaf Privilege Escalation

This module exploits a flaw in the AfdJoinLeaf function of 
the afd.sys driver to overwrite data in kernel space. An 
address within the HalDispatchTable is overwritten and when 
triggered with a call to NtQueryIntervalProfile will execute 
shellcode. This module will elevate itself to SYSTEM, then 
inject the payload into another SYSTEM process before 
restoring it's own token to avoid causing system 
instability.


## Module Name
exploit/windows/local/ms11_080_afdjoinleaf

## Authors
* Matteo Memelli
* Spencer McIntyre


## References
* http://cvedetails.com/cve/2011-2005/
* http://www.osvdb.org/76232
* https://www.exploit-db.com/exploits/18176
* http://technet.microsoft.com/en-us/security/bulletin/MS11-080
* http://www.offensive-security.com/vulndev/ms11-080-voyage-into-ring-zero/



## Targets
* Automatic
* Windows XP SP2 / SP3
* Windows Server 2003 SP2


## Platforms
* win

## Reliability
[Average](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/local/ms11_080_afdjoinleaf
msf exploit(ms11_080_afdjoinleaf) > show targets
   ... a list of targets ...
msf exploit(ms11_080_afdjoinleaf) > set TARGET <target-id>
msf exploit(ms11_080_afdjoinleaf) > show options
   ... show and set options ...
msf exploit(ms11_080_afdjoinleaf) > run
```
    
    