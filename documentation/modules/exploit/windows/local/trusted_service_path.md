## Windows Service Trusted Path Privilege Escalation

This module exploits a logic flaw due to how the 
lpApplicationName parameter is handled. When the 
lpApplicationName contains a space, the file name is 
ambiguous. Take this file path as example: C:\program 
files\hello.exe; The Windows API will try to interpret this 
as two possible paths: C:\program.exe, and C:\program 
files\hello.exe, and then execute all of them. To some 
software developers, this is an unexpected behavior, which 
becomes a security problem if an attacker is able to place a 
malicious executable in one of these unexpected paths, 
sometimes escalate privileges if run as SYSTEM. Some 
software such as OpenVPN 2.1.1, OpenSSH Server 5, and others 
have the same problem. The offensive technique is also 
described in Writing Secure Code (2nd Edition), Chapter 23, 
in the section "Calling Processes Security" on page 676.


## Module Name
exploit/windows/local/trusted_service_path

## Authors
* sinn3r


## References
* http://msdn.microsoft.com/en-us/library/windows/desktop/ms682425(v=vs.85).aspx
* http://www.microsoft.com/learning/en/us/book.aspx?id=5957&locale=en-us



## Targets
* Windows


## Platforms
* win

## Reliability
[Excellent](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/local/trusted_service_path
msf exploit(trusted_service_path) > show targets
   ... a list of targets ...
msf exploit(trusted_service_path) > set TARGET <target-id>
msf exploit(trusted_service_path) > show options
   ... show and set options ...
msf exploit(trusted_service_path) > run
```
    
    