## MS14-002 Microsoft Windows ndproxy.sys Local Privilege Escalation

This module exploits a flaw in the ndproxy.sys driver on 
Windows XP SP3 and Windows 2003 SP2 systems, exploited in 
the wild in November, 2013. The vulnerability exists while 
processing an IO Control Code 0x8fff23c8 or 0x8fff23cc, 
where user provided input is used to access an array 
unsafely, and the value is used to perform a call, leading 
to a NULL pointer dereference which is exploitable on both 
Windows XP and Windows 2003 systems. This module has been 
tested successfully on Windows XP SP3 and Windows 2003 SP2. 
In order to work the service "Routing and Remote Access" 
must be running on the target system.


## Module Name
exploit/windows/local/ms_ndproxy

## Authors
* Unknown
* ryujin
* Shahin Ramezany
* juan vazquez


## References
* http://cvedetails.com/cve/2013-5065/
* http://technet.microsoft.com/en-us/security/bulletin/MS14-002
* http://www.osvdb.org/100368
* http://www.securityfocus.com/bid/63971
* https://www.exploit-db.com/exploits/30014
* http://labs.portcullis.co.uk/blog/cve-2013-5065-ndproxy-array-indexing-error-unpatched-vulnerability/
* http://technet.microsoft.com/en-us/security/advisory/2914486
* http://www.secniu.com/blog/?p=53
* http://www.fireeye.com/blog/technical/cyber-exploits/2013/11/ms-windows-local-privilege-escalation-zero-day-in-the-wild.html
* http://blog.spiderlabs.com/2013/12/the-kernel-is-calling-a-zeroday-pointer-cve-2013-5065-ring-ring.html



## Targets
* Automatic
* Windows XP SP3
* Windows Server 2003 SP2


## Platforms
win

## Reliability
[Average](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/windows/local/ms_ndproxy
msf exploit(ms_ndproxy) > show targets
   ... a list of targets ...
msf exploit(ms_ndproxy) > set TARGET <target-id>
msf exploit(ms_ndproxy) > show options
   ... show and set options ...
msf exploit(ms_ndproxy) > run
```
    
    