## Wireshark LWRES Dissector getaddrsbyname_request Buffer Overflow

The LWRES dissector in Wireshark version 0.9.15 through 
1.0.10 and 1.2.0 through 1.2.5 allows remote attackers to 
execute arbitrary code due to a stack-based buffer overflow. 
This bug found and reported by babi. This particular exploit 
targets the dissect_getaddrsbyname_request function. Several 
other functions also contain potentially exploitable 
stack-based buffer overflows. The Windows version (of 1.2.5 
at least) is compiled with /GS, which prevents exploitation 
via the return address on the stack. Sending a larger string 
allows exploitation using the SEH bypass method. However, 
this packet will usually get fragmented, which may cause 
additional complications. NOTE: The vulnerable code is 
reached only when the packet dissection is rendered. If the 
packet is fragmented, all fragments must be captured and 
reassembled to exploit this issue.


## Module Name
exploit/multi/misc/wireshark_lwres_getaddrbyname

## Authors
* babi
* jduck
* redsand


## References
* http://cvedetails.com/cve/2010-0304/
* http://www.osvdb.org/61987
* http://www.securityfocus.com/bid/37985
* http://www.wireshark.org/security/wnpa-sec-2010-02.html
* http://anonsvn.wireshark.org/viewvc/trunk-1.2/epan/dissectors/packet-lwres.c?view=diff&r1=31596&r2=28492&diff_format=h



## Targets
* tshark 1.0.2-3+lenny7 on Debian 5.0.3 (x86)
* wireshark 1.0.2-3+lenny7 on Debian 5.0.3 (x86)
* wireshark 1.2.5 on RHEL 5.4 (x64)
* wireshark 1.2.5 on Mac OS X 10.5 (x86)
* wireshark/tshark 1.2.1 and 1.2.5 on Windows (x86)


## Platforms
* linux
* osx
* win

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/multi/misc/wireshark_lwres_getaddrbyname
msf exploit(wireshark_lwres_getaddrbyname) > show targets
   ... a list of targets ...
msf exploit(wireshark_lwres_getaddrbyname) > set TARGET <target-id>
msf exploit(wireshark_lwres_getaddrbyname) > show options
   ... show and set options ...
msf exploit(wireshark_lwres_getaddrbyname) > run
```
    
    