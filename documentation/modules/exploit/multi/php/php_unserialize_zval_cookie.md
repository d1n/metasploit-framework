## PHP 4 unserialize() ZVAL Reference Counter Overflow (Cookie)

This module exploits an integer overflow vulnerability in 
the unserialize() function of the PHP web server extension. 
This vulnerability was patched by Stefan in version 4.5.0 
and applies all previous versions supporting this function. 
This particular module targets numerous web applications and 
is based on the proof of concept provided by Stefan Esser. 
This vulnerability requires approximately 900k of data to 
trigger due the multiple Cookie headers requirement. Since 
we are already assuming a fast network connection, we use a 
2Mb block of shellcode for the brute force, allowing quick 
exploitation for those with fast networks. One of the neat 
things about this vulnerability is that on x86 systems, the 
EDI register points into the beginning of the hashtable 
string. This can be used with an egghunter to quickly 
exploit systems where the location of a valid "jmp EDI" or 
"call EDI" instruction is known. The EDI method is faster, 
but the bandwidth-intensive brute force used by this module 
is more reliable across a wider range of systems.


## Module Name
exploit/multi/php/php_unserialize_zval_cookie

## Authors
* hdm
* GML <grandmasterlogic[at]gmail.com>
* Stefan Esser <sesser[at]hardened-php.net>


## References
* http://cvedetails.com/cve/2007-1286/
* http://www.osvdb.org/32771
* http://www.php-security.org/MOPB/MOPB-04-2007.html



## Targets
* Linux x86 Generic
* Linux x86 phpBB2
* Linux x86 punBB
* Linux x86 WWWThreads
* Linux x86 Deadman Redirect
* Linux x86 PhpWebGallery
* Linux x86 Ariadne-CMS
* Linux x86 ProMA
* Linux x86 eGroupware


## Platforms
* linux

## Reliability
[Average](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/multi/php/php_unserialize_zval_cookie
msf exploit(php_unserialize_zval_cookie) > show targets
   ... a list of targets ...
msf exploit(php_unserialize_zval_cookie) > set TARGET <target-id>
msf exploit(php_unserialize_zval_cookie) > show options
   ... show and set options ...
msf exploit(php_unserialize_zval_cookie) > run
```
    
    