## ProFTPD 1.3.2rc3 - 1.3.3b Telnet IAC Buffer Overflow (Linux)

This module exploits a stack-based buffer overflow in 
versions of ProFTPD server between versions 1.3.2rc3 and 
1.3.3b. By sending data containing a large number of Telnet 
IAC commands, an attacker can corrupt memory and execute 
arbitrary code. The Debian Squeeze version of the exploit 
uses a little ROP stub to indirectly transfer the flow of 
execution to a pool buffer (the cmd_rec "res" in 
"pr_cmd_read"). The Ubuntu version uses a ROP stager to mmap 
RWX memory, copy a small stub to it, and execute the stub. 
The stub then copies the remainder of the payload in and 
executes it. NOTE: Most Linux distributions either do not 
ship a vulnerable version of ProFTPD, or they ship a version 
compiled with stack smashing protection. Although SSP 
significantly reduces the probability of a single attempt 
succeeding, it will not prevent exploitation. Since the 
daemon forks in a default configuration, the cookie value 
will remain the same despite some attemtps failing. By 
making repeated requests, an attacker can eventually guess 
the cookie value and exploit the vulnerability. The cookie 
in Ubuntu has 24-bits of entropy. This reduces the 
effectiveness and could allow exploitation in 
semi-reasonable amount of time.


## Module Name
exploit/linux/ftp/proftp_telnet_iac

## Authors
* jduck


## References
* http://cvedetails.com/cve/2010-4221/
* http://www.osvdb.org/68985
* http://www.securityfocus.com/bid/44562



## Targets
* Automatic Targeting
* Debug
* ProFTPD 1.3.3a Server (Debian) - Squeeze Beta1
* ProFTPD 1_3_3a Server (Debian) - Squeeze Beta1 (Debug)
* ProFTPD 1.3.2c Server (Ubuntu 10.04)


## Platforms
* linux

## Reliability
[Great](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/linux/ftp/proftp_telnet_iac
msf exploit(proftp_telnet_iac) > show targets
   ... a list of targets ...
msf exploit(proftp_telnet_iac) > set TARGET <target-id>
msf exploit(proftp_telnet_iac) > show options
   ... show and set options ...
msf exploit(proftp_telnet_iac) > run
```
    
    