## Samba SetInformationPolicy AuditEventsInfo Heap Overflow

This module triggers a vulnerability in the LSA RPC service 
of the Samba daemon because of an error on the PIDL 
auto-generated code. Making a specially crafted call to 
SetInformationPolicy to set a PolicyAuditEventsInformation 
allows to trigger a heap overflow and finally execute 
arbitrary code with root privileges. The module uses brute 
force to guess the stackpivot/rop chain or the system() 
address and redirect flow there in order to bypass NX. The 
start and stop addresses for brute forcing have been 
calculated empirically. On the other hand the module 
provides the StartBrute and StopBrute which allow the user 
to configure his own addresses.


## Module Name
exploit/linux/samba/setinfopolicy_heap

## Authors
* Unknown
* blasty
* mephos
* sinn3r
* juan vazquez


## References
* http://cvedetails.com/cve/2012-1182/
* http://www.osvdb.org/81303
* http://www.securityfocus.com/bid/52973
* http://www.zerodayinitiative.com/advisories/ZDI-12-069



## Targets
* 2:3.5.11~dfsg-1ubuntu2 on Ubuntu Server 11.10
* 2:3.5.8~dfsg-1ubuntu2 on Ubuntu Server 11.10
* 2:3.5.8~dfsg-1ubuntu2 on Ubuntu Server 11.04
* 2:3.5.4~dfsg-1ubuntu8 on Ubuntu Server 10.10
* 2:3.5.6~dfsg-3squeeze6 on Debian Squeeze
* 3.5.10-0.107.el5 on CentOS 5


## Platforms
* linux
* unix

## Reliability
[Normal](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)

## Demo

```
msf > use exploit/linux/samba/setinfopolicy_heap
msf exploit(setinfopolicy_heap) > show targets
   ... a list of targets ...
msf exploit(setinfopolicy_heap) > set TARGET <target-id>
msf exploit(setinfopolicy_heap) > show options
   ... show and set options ...
msf exploit(setinfopolicy_heap) > run
```
    
    