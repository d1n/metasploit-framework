require 'spec_helper'
require 'msf/core'
require 'msf/core/exploit/browser/session_store'

describe Msf::Exploit::Remote::SessionStore do
  subject(:server) do
    mod = Msf::Exploit.allocate
    mod.extend described_class
    mod.send(:initialize, {})
    mod
  end

  let(:mock_service) do
    mock_service = double("service")
    mock_service.stub(:server_name=)
    mock_service.stub(:add_resource)
    mock_service
  end

  before do
    Rex::ServiceManager.stub(:start => mock_service)
  end

  context 'after mixing into an exploit module' do
    it 'should respond to #session_store' do
      server.should respond_to(:session_store)
    end

    it 'should return an object of type Msf::Exploit::Remote::SessionStore::SessionStoreInstance' do
      server.session_store.should be_a(Msf::Exploit::Remote::SessionStore::SessionStoreInstance)
    end
  end
end
